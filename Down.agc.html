<!DOCTYPE html PUBLIC "-//W3C//DTD HTML 4.01 Transitional//EN">
<html>
<head>
<meta content="text/html;charset=ISO-8859-1" http-equiv="Content-Type">
<title>Assembly listing generated by yaYUL</title>
<style type="text/css">
p.nobreak { white-space:nowrap; }
a { text-decoration:none; }
a:visited { COLOR: #000850; }
</style>
<style type="text/css">
.op{
font-weight: bold;
color: #993300;
}
</style>
<style type="text/css">
.dn{
color: #009900;
}
</style>
<style type="text/css">
.fe{
color: #FF0000;
}
</style>
<style type="text/css">
.in{
color: #FF6600;
}
</style>
<style type="text/css">
.ps{
color: #336600;
}
</style>
<style type="text/css">
.sm{
color: #0000FF;
}
</style>
<style type="text/css">
.wn{
color: #FF9900;
}
</style>
<style type="text/css">
.co{
font-style: italic;
color: #993399;
}
</style>
</head>
<body>
<p class="nobreak">
<span style="font-family: monospace;">
<pre>
<h1>Source Code</h1>
<a name="53455455504D4F56"></a>000226,000001:    4201                        <span class="sm">SETUPMOV</span>                                                          
000227,000002: 
000228,000003:    4201           30007                           <span class="op">CA      </span> <a href="Constants.agc.html#5A45524F">ZERO</a>                                  <span class="co">#  Load 0 into A</span>
000229,000004:    4202           54103                           <span class="op">TS      </span> <a href="Ram.agc.html#4D415443484D44">MATCHMD</a>                               <span class="co">#  Clear array of 5 that indicates whether two numbers</span>
000230,000005:    4203           54104                           <span class="op">TS      </span> <a href="Ram.agc.html#4D4154434831">MATCH1</a>                                <span class="co">#  have already been combined for the given row/col</span>
000231,000006:    4204           54105                           <span class="op">TS      </span> <a href="Ram.agc.html#4D4154434832">MATCH2</a>                                
000232,000007:    4205           54106                           <span class="op">TS      </span> <a href="Ram.agc.html#4D4154434833">MATCH3</a>                                <span class="co">#  Otherwise moving left on a row of 0-0-1 would end as 2-x-x.</span>
000233,000008:    4206           54107                           <span class="op">TS      </span> <a href="Ram.agc.html#4D4154434834">MATCH4</a>                                <span class="co">#  When it should be 1-1-x.</span>
000234,000009: 
000235,000010:    4207           00002                           <span class="op">RETURN  </span>                                       
000236,000011: 
<a name="4D4F56455F444F57"></a>000237,000012:    4210                        <span class="sm">MOVE_DOWN</span>                                                          <span class="co">#  The down key (8) has been pressed</span>
000238,000013: 
000239,000014:    4210           04201                           <span class="op">TC      </span> <a href="#53455455504D4F56">SETUPMOV</a>                              <span class="co">#  Setup a table and check if can proceed - may never return!</span>
000240,000015:    4211           30112                           <span class="op">CA      </span> <a href="Ram.agc.html#474D5F444F4E45">GM_DONE</a>                               <span class="co">#  Load game complete status into A</span>
000241,000016:    4212           00006                           <span class="op">EXTEND  </span>                                       
000242,000017:    4213           14215                           <span class="op">BZF     </span> <a href="#4D4F56494E475F44">MOVING_DN</a>                             <span class="co">#  Flag is zero, not complete yet</span>
000243,000018: 
000244,000019:    4214           14070                           <span class="op">TCF     </span> <a href="Main.agc.html#4D41494E4C4F4F50">MAINLOOP</a>                              
000245,000020: 
<a name="4D4F56494E475F44"></a>000246,000021:    4215                        <span class="sm">MOVING_DN</span>                                                          <span class="co">#  Once in a state of 'sta_down', come here each 'frame'</span>
000247,000022:                                                                                                  <span class="co">#  until no more cells can move down</span>
000248,000023: 
000249,000024:    4215           35254                           <span class="op">CA      </span> <a href="Tables.agc.html#5354415F444F574E">STA_DOWN</a>                              <span class="co">#  Load the game status of 'moving down'</span>
000250,000025:    4216           54101                           <span class="op">TS      </span> <a href="Ram.agc.html#474D5F5354415445">GM_STATE</a>                              <span class="co">#  Save as game state</span>
000251,000026: 
000252,000027:    4217           30007                           <span class="op">CA      </span> <a href="Constants.agc.html#5A45524F">ZERO</a>                                  <span class="co">#  Load 0 into A</span>
000253,000028:    4220           54123                           <span class="op">TS      </span> <a href="Ram.agc.html#504C41595F4944">PLAY_ID</a>                               <span class="co">#  Reset number of cells moved this iteration.</span>
000254,000029: 
000255,000030:    4221           35254                           <span class="op">CA      </span> <a href="Tables.agc.html#44454331">DEC1</a>                                  <span class="co">#  Start from middle row, checking below to see if we can move into it.</span>
000256,000031:    4222           54113                           <span class="op">TS      </span> <a href="Ram.agc.html#524F575F4944">ROW_ID</a>                                <span class="co">#  Store 1 into ROW_ID</span>
000257,000032: 
<a name="445F524F4C4F4F50"></a>000258,000033:    4223                        <span class="sm">D_ROLOOP</span>                                                          <span class="co">#  Loop through rows, checking each column to see if number can move down</span>
000259,000034: 
000260,000035:    4223           50113                           <span class="op">INDEX   </span> <a href="Ram.agc.html#524F575F4944">ROW_ID</a>                                <span class="co">#  Index by the row_id</span>
000261,000036:    4224           35277                           <span class="op">CA      </span> <a href="Tables.agc.html#524F575F53545254">ROW_STRT</a>                              <span class="co">#  Get the first cell id in this row</span>
000262,000037:    4225           54075                           <span class="op">TS      </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Store this as current id</span>
000263,000038:    4226           65260                           <span class="op">AD      </span> <a href="Tables.agc.html#44454335">DEC5</a>                                  <span class="co">#  Add 5</span>
000264,000039:    4227           54115                           <span class="op">TS      </span> <a href="Ram.agc.html#454E445F4944">END_ID</a>                                <span class="co">#  Store cur_id + 5 to know when to stop processing row</span>
000265,000040: 
<a name="445F434F4C4F4F50"></a>000266,000041:    4230                        <span class="sm">D_COLOOP</span>                                                          <span class="co">#  Loop through each cell on a row</span>
000267,000042: 
000268,000043: 
000269,000044:    4230           50075                           <span class="op">INDEX   </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Index by the current cell id</span>
000270,000045:    4231           35307                           <span class="op">CA      </span> <a href="Tables.agc.html#475249445F434F4C">GRID_COL</a>                              <span class="co">#  Get the column this cell belongs to</span>
000271,000046:    4232           54111                           <span class="op">TS      </span> <a href="Ram.agc.html#43454C4C434F4C">CELLCOL</a>                               <span class="co">#  And save value to ram for later</span>
000272,000047: 
000273,000048:    4233           50075                           <span class="op">INDEX   </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Index by the current cell id again</span>
000274,000049:    4234           30124                           <span class="op">CA      </span> <a href="Ram.agc.html#56414C554553">VALUES</a>                                <span class="co">#  Get the value in this cell</span>
000275,000050:    4235           54100                           <span class="op">TS      </span> <a href="Ram.agc.html#43454C4C5F56414C">CELL_VALUE</a>                            <span class="co">#  Save cell value</span>
000276,000051:    4236           65254                           <span class="op">AD      </span> <a href="Tables.agc.html#44454331">DEC1</a>                                  <span class="co">#  Add 1. If empty (-1), this is now 0.</span>
000277,000052:    4237           00006                           <span class="op">EXTEND  </span>                                       
000278,000053:    4240           14271                           <span class="op">BZF     </span> <a href="#445F4E4F434F4C">D_NOCOL</a>                               <span class="co">#  If empty, don't bother checking cell below</span>
000279,000054: 
000280,000055: 
<a name="43484B5F42454C"></a>000281,000056:    4241                        <span class="sm">CHK_BEL </span>                                                          <span class="co">#  This cell has a number, check below</span>
000282,000057: 
000283,000058:    4241           30075                           <span class="op">CA      </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Load the current cell id</span>
000284,000059:    4242           65260                           <span class="op">AD      </span> <a href="Tables.agc.html#44454335">DEC5</a>                                  <span class="co">#  Add 5 (number of columns) to get cell below</span>
000285,000060:    4243           54077                           <span class="op">TS      </span> <a href="Ram.agc.html#43484B5F4944">CHK_ID</a>                                <span class="co">#  Store cell check id</span>
000286,000061: 
000287,000062:    4244           50077                           <span class="op">INDEX   </span> <a href="Ram.agc.html#43484B5F4944">CHK_ID</a>                                <span class="co">#  Index using the cell below's id</span>
000288,000063:    4245           30124                           <span class="op">CA      </span> <a href="Ram.agc.html#56414C554553">VALUES</a>                                <span class="co">#  Get the value in the cell below</span>
000289,000064:    4246           54102                           <span class="op">TS      </span> <a href="Ram.agc.html#43484B5F56414C55">CHK_VALUE</a>                             <span class="co">#  Store the cell below's value</span>
000290,000065:    4247           65254                           <span class="op">AD      </span> <a href="Tables.agc.html#44454331">DEC1</a>                                  <span class="co">#  Add 1. If empty (-1), this is now 0.</span>
000291,000066:    4250           00006                           <span class="op">EXTEND  </span>                                       
000292,000067:    4251           14270                           <span class="op">BZF     </span> <a href="#4D4F565F444E">MOV_DN</a>                                <span class="co">#  If cell below empty, we can move straight into it.</span>
000293,000068: 
<a name="445F534F4D454852"></a>000294,000069:    4252                        <span class="sm">D_SOMEHR</span>                                                          <span class="co">#  There's a number below. Check what it is.</span>
000295,000070: 
000296,000071:    4252           50111                           <span class="op">INDEX   </span> <a href="Ram.agc.html#43454C4C434F4C">CELLCOL</a>                               <span class="co">#  Index by the column our cell is in</span>
000297,000072:    4253           30103                           <span class="op">CA      </span> <a href="Ram.agc.html#4D415443484D44">MATCHMD</a>                               <span class="co">#  Get whether we already combined cells in this column</span>
000298,000073:    4254           00006                           <span class="op">EXTEND  </span>                                       
000299,000074:    4255           14257                           <span class="op">BZF     </span> <a href="#445F4E4F534F46">D_NOSOF</a>                               <span class="co">#  If 0, we didn't already combine so we can check for match</span>
000300,000075: 
000301,000076:    4256           14271                           <span class="op">TCF     </span> <a href="#445F4E4F434F4C">D_NOCOL</a>                               <span class="co">#  We already combined so we don't want to try and combine again</span>
000302,000077: 
<a name="445F4E4F534F46"></a>000303,000078:    4257                        <span class="sm">D_NOSOF </span>                                                          
000304,000079: 
000305,000080:    4257           30100                           <span class="op">CA      </span> <a href="Ram.agc.html#43454C4C5F56414C">CELL_VALUE</a>                            <span class="co">#  Load the value in original cell</span>
000306,000081:    4260           00006                           <span class="op">EXTEND  </span>                                       
000307,000082:    4261           60102                           <span class="op">SU      </span> <a href="Ram.agc.html#43484B5F56414C55">CHK_VALUE</a>                             <span class="co">#  Subtract the value in cell below</span>
000308,000083:    4262           00006                           <span class="op">EXTEND  </span>                                       
000309,000084:    4263           14265                           <span class="op">BZF     </span> <a href="#445F4D41544348">D_MATCH</a>                               <span class="co">#  If zero, they are the same. Combine them.</span>
000310,000085: 
000311,000086:    4264           14271                           <span class="op">TCF     </span> <a href="#445F4E4F434F4C">D_NOCOL</a>                               <span class="co">#  Not the same, can't move as way is blocked</span>
000312,000087: 
<a name="445F4D41544348"></a>000313,000088:    4265                        <span class="sm">D_MATCH </span>                                                          
000314,000089: 
000315,000090:    4265           50111                           <span class="op">INDEX   </span> <a href="Ram.agc.html#43454C4C434F4C">CELLCOL</a>                               <span class="co">#  Index by the column these cells are in</span>
000316,000091:    4266           04331                           <span class="op">TC      </span> <a href="#55504752414445">UPGRADE</a>                               <span class="co">#  Increase target cell, empty orig cell</span>
000317,000092: 
000318,000093:    4267           14271                           <span class="op">TCF     </span> <a href="#445F4E4F434F4C">D_NOCOL</a>                               <span class="co">#  Move along to next column</span>
<a name="4D4F565F444E"></a>000319,000094:    4270                        <span class="sm">MOV_DN  </span>                                                          
000320,000095: 
000321,000096:    4270           04321                           <span class="op">TC      </span> <a href="#43454C4C5F4D4F56">CELL_MOV</a>                              <span class="co">#  Move cell value to new cell, empty orig cell</span>
000322,000097: 
<a name="445F4E4F434F4C"></a>000323,000098:    4271                        <span class="sm">D_NOCOL </span>                                                          <span class="co">#  End of processing for this column</span>
000324,000099: 
000325,000100:    4271           24075                           <span class="op">INCR    </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Move cell id to next column</span>
000326,000101:    4272           30075                           <span class="op">CA      </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Load id into A</span>
000327,000102:    4273           00006                           <span class="op">EXTEND  </span>                                       
000328,000103:    4274           60115                           <span class="op">SU      </span> <a href="Ram.agc.html#454E445F4944">END_ID</a>                                <span class="co">#  Subtract id of first cell in row below</span>
000329,000104:    4275           00006                           <span class="op">EXTEND  </span>                                       
000330,000105:    4276           14300                           <span class="op">BZF     </span> <a href="#445F4E58545257">D_NXTRW</a>                               <span class="co">#  If zero, we have no more columns, goto next row</span>
000331,000106: 
000332,000107:    4277           14230                           <span class="op">TCF     </span> <a href="#445F434F4C4F4F50">D_COLOOP</a>                              <span class="co">#  More columns to process, loop back up</span>
000333,000108: 
<a name="445F4E58545257"></a>000334,000109:    4300                        <span class="sm">D_NXTRW </span>                                                          
000335,000110: 
000336,000111:    4300           54067                           <span class="op">TS      </span> <a href="Ram.agc.html#4E45574A4F42">NEWJOB</a>                                <span class="co">#  Nudge watchdog as this processing might take a while</span>
000337,000112:    4301           30113                           <span class="op">CA      </span> <a href="Ram.agc.html#524F575F4944">ROW_ID</a>                                <span class="co">#  Load the row id</span>
000338,000113:    4302           00006                           <span class="op">EXTEND  </span>                                       
000339,000114: 
000340,000115:    4303           14307                           <span class="op">BZF     </span> <a href="#445F444F4E45">D_DONE</a>                                <span class="co">#  If row id is zero, we've done all rows now</span>
000341,000116: 
000342,000117:    4304           00006                           <span class="op">EXTEND  </span>                                       
000343,000118:    4305           26113                           <span class="op">DIM     </span> <a href="Ram.agc.html#524F575F4944">ROW_ID</a>                                <span class="co">#  Not last row, move up into next row</span>
000344,000119: 
000345,000120:    4306           14223                           <span class="op">TCF     </span> <a href="#445F524F4C4F4F50">D_ROLOOP</a>                              <span class="co">#  Process the next row</span>
000346,000121: 
<a name="445F444F4E45"></a>000347,000122:    4307                        <span class="sm">D_DONE  </span>                                                          
000348,000123: 
000349,000124:    4307           30123                           <span class="op">CA      </span> <a href="Ram.agc.html#504C41595F4944">PLAY_ID</a>                               <span class="co">#  Did we move anything in this iteration?</span>
000350,000125:    4310           00006                           <span class="op">EXTEND  </span>                                       
000351,000126:    4311           14315                           <span class="op">BZF     </span> <a href="#445F4E4F5754">D_NOWT</a>                                <span class="co">#  If 0 we did not so return control to player</span>
000352,000127: 
<a name="445F555044415445"></a>000353,000128:    4312                        <span class="sm">D_UPDATE</span>                                                          
000354,000129: 
000355,000130:    4312           04703                           <span class="op">TC      </span> <a href="Display.agc.html#444953503135">DISP15</a>                                <span class="co">#  We moved something, update display</span>
000356,000131:    4313           04775                           <span class="op">TC      </span> <a href="Display.agc.html#494F44454C4159">IODELAY</a>                               <span class="co">#  Delay a bit so numbers don't move instantly from one end to other</span>
000357,000132:    4314           14070                           <span class="op">TCF     </span> <a href="Main.agc.html#4D41494E4C4F4F50">MAINLOOP</a>                              <span class="co">#  Return to main loop to see if anything still to move</span>
000358,000133: 
<a name="445F4E4F5754"></a>000359,000134:    4315                        <span class="sm">D_NOWT  </span>                                                          
000360,000135:    4315           35260                           <span class="op">CA      </span> <a href="Tables.agc.html#5354415F414444">STA_ADD</a>                               <span class="co">#  All movement handled, now add new number to grid</span>
000361,000136:    4316           54101                           <span class="op">TS      </span> <a href="Ram.agc.html#474D5F5354415445">GM_STATE</a>                              <span class="co">#  Save to game state, we'll do in next main loop</span>
000362,000137: 
000363,000138:    4317           04775                           <span class="op">TC      </span> <a href="Display.agc.html#494F44454C4159">IODELAY</a>                               <span class="co">#  A little delay before adding so it's obvious where it went</span>
000364,000139: 
000365,000140:    4320           14070                           <span class="op">TCF     </span> <a href="Main.agc.html#4D41494E4C4F4F50">MAINLOOP</a>                              <span class="co">#  Return to main loop which will add a new number next time</span>
000366,000141: 
000367,000142: 
<a name="43454C4C5F4D4F56"></a>000368,000143:    4321                        <span class="sm">CELL_MOV</span>                                                          
000369,000144: 
000370,000145:    4321           24123                           <span class="op">INCR    </span> <a href="Ram.agc.html#504C41595F4944">PLAY_ID</a>                               <span class="co">#  We are moving a number into empty space. Inc move counter.</span>
000371,000146: 
000372,000147:    4322           30100                           <span class="op">CA      </span> <a href="Ram.agc.html#43454C4C5F56414C">CELL_VALUE</a>                            <span class="co">#  Load the value in cell that's moving</span>
000373,000148:    4323           50077                           <span class="op">INDEX   </span> <a href="Ram.agc.html#43484B5F4944">CHK_ID</a>                                <span class="co">#  Index by cell below id</span>
000374,000149:    4324           54124                           <span class="op">TS      </span> <a href="Ram.agc.html#56414C554553">VALUES</a>                                <span class="co">#  Set cell below to value of original cell</span>
000375,000150: 
000376,000151:    4325           35140                           <span class="op">CA      </span> <a href="Constants.agc.html#4E45475F4F4E45">NEG_ONE</a>                               <span class="co">#  Load -1 to A (empty)</span>
000377,000152:    4326           50075                           <span class="op">INDEX   </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Index by original cell id</span>
000378,000153:    4327           54124                           <span class="op">TS      </span> <a href="Ram.agc.html#56414C554553">VALUES</a>                                <span class="co">#  Set original cell to now be empty</span>
000379,000154: 
000380,000155:    4330           00002                           <span class="op">RETURN  </span>                                       
000381,000156: 
<a name="55504752414445"></a>000382,000157:    4331                        <span class="sm">UPGRADE </span>                                                          
000383,000158: 
000384,000159: 
000385,000160:    4331           24123                           <span class="op">INCR    </span> <a href="Ram.agc.html#504C41595F4944">PLAY_ID</a>                               <span class="co">#  Increase counter as something is going to move</span>
000386,000161: 
000387,000162:    4332           30100                           <span class="op">CA      </span> <a href="Ram.agc.html#43454C4C5F56414C">CELL_VALUE</a>                            <span class="co">#  Load value in original cell</span>
000388,000163:    4333           65254                           <span class="op">AD      </span> <a href="Tables.agc.html#44454331">DEC1</a>                                  <span class="co">#  Add 1 because we are combining</span>
000389,000164:    4334           50077                           <span class="op">INDEX   </span> <a href="Ram.agc.html#43484B5F4944">CHK_ID</a>                                <span class="co">#  Index using cell below id</span>
000390,000165:    4335           54124                           <span class="op">TS      </span> <a href="Ram.agc.html#56414C554553">VALUES</a>                                <span class="co">#  Set cell below to be +1</span>
000391,000166:    4336           54061                           <span class="op">TS      </span> <a href="Ram.agc.html#54454D5049">TEMPI</a>                                 <span class="co">#  Save to temp var, we need to check if it's 9</span>
000392,000167: 
000393,000168:    4337           35264                           <span class="op">CA      </span> <a href="Tables.agc.html#44454339">DEC9</a>                                  <span class="co">#  Load 9 into A</span>
000394,000169:    4340           00006                           <span class="op">EXTEND  </span>                                       
000395,000170:    4341           60061                           <span class="op">SU      </span> <a href="Ram.agc.html#54454D5049">TEMPI</a>                                 <span class="co">#  Subtract the value of combined cell</span>
000396,000171:    4342           00006                           <span class="op">EXTEND  </span>                                       
000397,000172:    4343           14345                           <span class="op">BZF     </span> <a href="#434F4D504C455445">COMPLETE</a>                              <span class="co">#  If zero, we must have made a 9, game complete</span>
000398,000173: 
000399,000174:    4344           14351                           <span class="op">TCF     </span> <a href="#4E4F54434F4D50">NOTCOMP</a>                               <span class="co">#  If zero, we must have made a 9, game complete</span>
000400,000175: 
000401,000176: 
<a name="434F4D504C455445"></a>000402,000177:    4345                        <span class="sm">COMPLETE</span>                                                          
000403,000178: 
000404,000179:    4345           35152                           <span class="op">CA      </span> <a href="Constants.agc.html#42495435">BIT5</a>                                  <span class="co">#  Load value where bit 5 = 1, rest 0 (key rel flash)</span>
000405,000180:    4346           00006                           <span class="op">EXTEND  </span>                                       
000406,000181:    4347           01011                           <span class="op">WRITE   </span> <a href="Constants.agc.html#43483131">CH11</a>                                  <span class="co">#  Output to DSKY lights IO channel</span>
000407,000182:    4350           24112                           <span class="op">INCR    </span> <a href="Ram.agc.html#474D5F444F4E45">GM_DONE</a>                               <span class="co">#  Set done flag so we don't allow further play'</span>
000408,000183: 
<a name="4E4F54434F4D50"></a>000409,000184:    4351                        <span class="sm">NOTCOMP </span>                                                          
000410,000185: 
000411,000186: 
000412,000187:    4351           35140                           <span class="op">CA      </span> <a href="Constants.agc.html#4E45475F4F4E45">NEG_ONE</a>                               <span class="co">#  Load -1 to A (empty)</span>
000413,000188:    4352           50075                           <span class="op">INDEX   </span> <a href="Ram.agc.html#4355525F4944">CUR_ID</a>                                <span class="co">#  Index by original cell id</span>
000414,000189:    4353           54124                           <span class="op">TS      </span> <a href="Ram.agc.html#56414C554553">VALUES</a>                                <span class="co">#  Set original cell to now be empty</span>
000415,000190: 
000416,000191: 
000417,000192: 
000418,000193:    4354           00002                           <span class="op">RETURN  </span>                                       
000419,000194: 

End of include-file Down.agc.  Parent file is <a href="Main.agc.html">Main.agc</a>
</pre>
</span>
</p>
</body>
</html>
